{"version":3,"sources":["file:///D:/program/cocos/project/FlappyBird/assets/scripts/GameManager.ts"],"names":["_decorator","AudioClip","Component","Label","Node","Bird","MoveBg","PipeSpawner","GameReadyUI","GameData","GameOverUI","AudioMgr","ccclass","property","GameState","GameManager","curGS","Ready","inst","_inst","onLoad","start","transitionToReadyState","play","bgAudio","bird","disableControl","bgMoving","disableMoving","landMoving","pause","gameOverUI","hide","gamingUI","active","gameReadyUI","node","transitionToGamingState","Gaming","enableControl","enableMoving","transitionToGameOverState","GameOver","disableControlNotRGD","show","getScore","getBestScore","saveScore","stop","playOneShot","gameOverAudio","addScore","count","scoreLabel","string","toString"],"mappings":"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","sourcesContent":["import { _decorator, AudioClip, Component, Label, Node } from 'cc';\r\nimport { Bird } from './Bird';\r\nimport { MoveBg } from './MoveBg';\r\nimport { PipeSpawner } from './PipeSpawner';\r\nimport { GameReadyUI } from './UI/GameReadyUI';\r\nimport { GameData } from './GameData';\r\nimport { GameOverUI } from './UI/GameOverUI';\r\nimport { AudioMgr } from './AudioMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\nenum GameState{\r\n    Ready,\r\n    Gaming,\r\n    GameOver\r\n}\r\n@ccclass(\"GameManager\")\r\nexport class GameManager extends Component {\r\n  private static _inst: GameManager = null;\r\n  public static inst() {\r\n    return this._inst;\r\n  }\r\n\r\n  @property\r\n  moveSpeed: number = 100;\r\n  @property(Bird)\r\n  bird: Bird = null;\r\n  @property(MoveBg)\r\n  bgMoving: MoveBg = null;\r\n  @property(MoveBg)\r\n  landMoving: MoveBg = null;\r\n  @property(PipeSpawner)\r\n  PipeSpawner: PipeSpawner = null;\r\n  @property(GameReadyUI)\r\n  gameReadyUI: GameReadyUI = null;\r\n  @property(Node)\r\n  gamingUI: Node = null;\r\n  @property(GameOverUI)\r\n  gameOverUI: GameOverUI = null;\r\n\r\n  @property(Label)\r\n  scoreLabel: Label = null;\r\n\r\n  @property(AudioClip)\r\n  bgAudio: AudioClip = null;\r\n  @property(AudioClip)\r\n  gameOverAudio: AudioClip = null;\r\n  curGS: GameState = GameState.Ready;\r\n\r\n  onLoad() {\r\n    GameManager._inst = this;\r\n  }\r\n  protected start(): void {\r\n    this.transitionToReadyState();\r\n    //后面参数是音量\r\n    AudioMgr.inst.play(this.bgAudio, 0.1);\r\n  }\r\n  transitionToReadyState() {\r\n    this.curGS = GameState.Ready;\r\n    this.bird.disableControl();\r\n    this.bgMoving.disableMoving();\r\n    this.landMoving.disableMoving();\r\n    this.PipeSpawner.pause();\r\n    this.gameOverUI.hide();\r\n    this.gamingUI.active = false;\r\n    this.gameReadyUI.node.active = true;\r\n  }\r\n  transitionToGamingState() {\r\n    this.curGS = GameState.Gaming;\r\n    this.bird.enableControl();\r\n    this.bgMoving.enableMoving();\r\n    this.landMoving.enableMoving();\r\n    this.PipeSpawner.start();\r\n    this.gameReadyUI.node.active = false;\r\n    this.gamingUI.active = true;\r\n  }\r\n  transitionToGameOverState() {\r\n    if (this.curGS == GameState.GameOver) return;\r\n    this.curGS = GameState.GameOver;\r\n\r\n    this.bird.disableControlNotRGD();\r\n    this.bgMoving.disableMoving();\r\n    this.landMoving.disableMoving();\r\n    this.PipeSpawner.pause();\r\n    this.gamingUI.active = false;\r\n    this.gameOverUI.show(GameData.getScore(), GameData.getBestScore());\r\n    GameData.saveScore();\r\n    AudioMgr.inst.stop()\r\n     AudioMgr.inst.playOneShot(this.gameOverAudio);\r\n  }\r\n\r\n  addScore(count: number = 1) {\r\n    GameData.addScore();\r\n    this.scoreLabel.string = GameData.getScore().toString();\r\n  }\r\n}\r\n\r\n\r\n"]}